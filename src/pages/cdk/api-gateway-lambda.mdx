export const meta = {
  title: 'API Gateway and Lambda Integration',
};

import { MyLayoutTest } from './../../components/Layout/MyLayout';

![aws_devops-ica drawio](https://user-images.githubusercontent.com/20411077/171420579-1c61993f-5c43-4dba-92bc-256fc434d337.png)

[Define an API](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway-readme.html#authorizers)

- **Resources**
- **Methods**: GET, POST, DELETE, UPDATE
- [**Authentication**](https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html): IAM, Token, Cognito, and ...

Best practices

- [Usage plans and APIs key](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-api-usage-plans.html)
- [API Gateway service quotas](https://docs.aws.amazon.com/apigateway/latest/developerguide/limits.html)
  - Throttle 10,000 RPS / account
  - Integration timeout 29 seconds
  - ...

## API Gateway

create an api gateway

```tsx
const api = new aws_apigateway.RestApi(this, 'ApiGw', {
  restApiName: 'ica-demo',
});
```

add a resource

```tsx
const resource = api.root.addResource('ica-demo');
```

add a method with Lambda integration

```tsx
resource.addMethod('GET', new aws_apigateway.LambdaIntegration(handler));
```

## Lambda function

```tsx
const handler = new aws_lambda.Function(this, 'LambdaFunction', {
  functionName: 'IcaLambdaApiGateway',
  runtime: aws_lambda.Runtime.PYTHON_3_8,
  timeout: Duration.seconds(10),
  memorySize: 512,
  code: aws_lambda.Code.fromAsset(path.join(__dirname, 'lambda')),
  handler: 'index.handler',
  environment: {
    BUCKET_PREFIX_RESULT: 'lambda-api-gw',
  },
  role,
});
```

role for lambda execution

```tsx
const role = new aws_iam.Role(this, 'RoleForLambda', {
  roleName: 'RoleForLambda',
  assumedBy: new aws_iam.ServicePrincipal('lambda.amazonaws.com'),
});

// attach inline policies
role.attachInlinePolicy(
  new aws_iam.Policy(this, 'PolicyForLambda', {
    statements: [
      new aws_iam.PolicyStatement({
        effect: aws_iam.Effect.ALLOW,
        actions: ['s3:*', 's3-object-lambda:*'],
        resources: ['arn:aws:s3:::haimtran-workspace/*'],
      }),
    ],
  })
);
```

export default ({ children }) => (
  <MyLayoutTest frontmatter={meta}>{children}</MyLayoutTest>
);
